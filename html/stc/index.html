<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2D2D2D" />
  
  <title>Chris Rordens Neuropsychology Lab :: Slice Time Correction (STC)</title>
  

  <link rel="icon" type="image/png" sizes="32x32" href="../_static/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../_static/img/favicon-16x16.png">
        <link rel="index" title="Index"
              href="../genindex.html"/>

  <link rel="stylesheet" href="../_static/css/insegel.css"/>

  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'',
        VERSION:'0.1',
        LANGUAGE:'None',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
    };
  </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>

  <script src="https://email.tl.fortawesome.com/c/eJxNjUEOgyAQAF8jR7Kw6wIHDh7sP1Cw2mgxgmn6-3JsMqc5zEQfE8dkxOY1KKMUOI3ACFKRJpSW2AAp7ontYIaxI6i7XPJVwyeVfCQ550Os3jLrGSNOLgbdAy6s0PBk2TFNjEbsfq31LB0OnX407pJa5v2faRadwSW63mn5KuLyR9j2tgx3zecanl-55R_-jjPs"></script>

</head>

<body>
  <div id="insegel-container">
    <header>
      <div id="logo-container">
          
          <a href="../index.html"><img src="../_static/img/logo.svg"></a>
          

      </div>
      <div id="project-container">
        <h1>Chris Rordens Neuropsychology Lab Documentation</h1>
      </div>
    </header>

    <div id="content-container">

      <div id="main-content-container">
        <div id="main-content-header">
          <h1>Slice Time Correction (STC)</h1>
        </div>
        <div id="main-content">
          
  <div class="section" id="slice-time-correction-stc">
<h1>Slice Time Correction (STC)<a class="headerlink" href="#slice-time-correction-stc" title="Permalink to this headline">¶</a></h1>
<p>Modern functional magnetic imaging uses echo (or spiral) planar imaging where a 3D volume is built up from a series of 2D slices. Each slice take some time to acquire, so different slices in a 3D stack were actually observed at different time points. On the other hand, our statistics assumes that the 3D volume was acquired at the same moment in time. Therefore, it is common to slice time correct (STC). This page describes how to compute STC and describes special caveats for Siemens scanners as well as with SPM8’s STC function.</p>
<a class="reference internal image-reference" href="../_images/slice_order_1.jpg"><img alt="../_images/slice_order_1.jpg" class="align-center" src="../_images/slice_order_1.jpg" style="width: 444px;" /></a>
<p>Slice Time Correction (STC) generally improves our the statistical power of fMRI analyses. In particular it is probably a good idea for event-related designs (and less useful for block designs). The irony is that Slice Time Correction (STC) is most important yet least effective when the speed of acquisition is slower. For example, consider an ascending continuous acquisition with a TR (repeat time, time between volumes) of 3000ms. In this case the middle slice is observed almost 1.5s after the first slice, and the final slice almost 3s later. If our TR was 1000ms the error would be 1/3 this size. STC works by interpolating between images (either directly or via Fourier transforms). If we want to see what a slice looks like at an earlier unobserved time, we simply estimate based on the observations we acquired immediately prior to and after the desired time. A nice analogy is estimating the temperature at 9am: we can be more accurate if our closest observations were at 8:55am and 9:05am rather than at 8am and 10am.</p>
<div class="section" id="slice-order">
<h2>Slice order<a class="headerlink" href="#slice-order" title="Permalink to this headline">¶</a></h2>
<p>The cartoon on the depicts a volume where we acquire four 2D slices for each 3D volume of the brain. For the traditional echo-planar-imaging (EPI) we acquire each of these slices sequentially (for multi-band we can acquire a few spatially distant slices simultaneously). Therefore, with traditional EPI we do not see the whole brain at the same instance, but see different portions at different times. One can consider several slice orderings to acquire this image:</p>
<ul class="simple">
<li><p>Sequential Ascending 1,2,3,4,5,6</p></li>
<li><p>Sequential Descending 6,5,4,3,2,1</p></li>
<li><p>Interleaved Ascending 1,3,5,2,4,6</p></li>
<li><p>Interleaved Descending 6,4,2,5,3,1</p></li>
<li><p>Interleaved Ascending <cite>*</cite> 2,4,6,1,3,5</p></li>
<li><p>Interleaved Descending <cite>*</cite> 5,3,1,6,4,2</p></li>
</ul>
<p>In other words, with typical interleaved ascending we acquire the odd numbered slices first followed by the even numbered slices. Note that the slice orders number 5 and 6 (marked with a <cite>*</cite>) are weird. While other manufacturers use only slice ordering types 3 and 4, for some odd reason Siemens Product sequences use order 3 when you acquire interleaved with an odd number of slices and order 5 when you acquire with an even number of slices. This is described in Joachim Graessner’s <a class="reference external" href="https://static.healthcare.siemens.com/siemens_hwem-hwem_ssxa_websites-context-root/wcm/idc/groups/public/&#64;global/&#64;imaging/&#64;mri/documents/download/mdaz/nzmy/~edisp/mri_60_graessner-01646277.pdf">Slice Order (Slice Timing) for fMRI Evaluation</a>.However, as described below, those using the <a class="reference external" href="https://www.cmrr.umn.edu/multiband/">terrific CMRR sequences</a> on Siemens, be aware that the manual states ‘that slice excitation always starts with slice0 (the first slice) in CMRR multiband C2P sequences’. The section below describes how to test your own sequence to ensure slice order.</p>
<p>Most MRI scanners let you set your desired slice order. Interleaved acquisitions can have less slice interference but can show <a class="reference external" href="http://imaging.mrc-cbu.cam.ac.uk/imaging/CommonArtefacts#spinhistory">spin history effects</a> if a participant moves. This is the reason most fMRI data has a ~20% gap between slices, as it reduces both interference and motion-related spin history artifacts (at the cost of less signal).</p>
</div>
<div class="section" id="siemens-specific-details">
<h2>Siemens specific details<a class="headerlink" href="#siemens-specific-details" title="Permalink to this headline">¶</a></h2>
<p>The image on the right shows two fMRI volumes from a Siemens scanner using an ascending interleaved sequence. The only difference between the two sequences is that one volume (left) has 35 slices and the other (right) has 36 slices. In both scans <a class="reference external" href="http://akiraoconnor.org/2010/09/01/the-physical-reality-of-fmri-slice-acquisition-order/">the participant started with their head aligned with the scanner bore and then rotated their head half way through the acquisition</a> . Note that the acquisition pattern is different: the head motion appears on the even numbered slices for the 35 slice volume (odd-first “Interleaved Ascending” pattern) and on the odd numbered slices for 36 volume slices (even first “Interleaved Ascending <cite>*</cite>” pattern). As far as I know, all Siemens sequences use the standard (odd first) interleaving sequence for volumes with odd numbers of slices and the alternative (even first, <cite>*</cite>) pattern when acquiring an even number of slices. However, you may want to test this for yourself on your system.</p>
<a class="reference internal image-reference" href="../_images/interleaved.jpg"><img alt="../_images/interleaved.jpg" class="align-center" src="../_images/interleaved.jpg" style="width: 781px;" /></a>
<p>You have a couple options to determine the slice order you can either look at your <a class="reference external" href="http://cbs.fas.harvard.edu/node/559#slice_order">scanner console</a> , look at the “Series” in your protocol PDF files (shown in red in the image on the right – ignore the “multi-slice mode”), or use software that detects this for you when converting your DICOM files for subsequent processing (for example, dcm2nii since 2014 do this for Siemens images).</p>
<p>Another question regards what direction ‘ascending’ and ‘descending’ refer to. For axial slices it seems obvious that ascending refers to acquisitions that begin near the feet and move toward the head. But what does ‘ascending’ versus ‘descending’ refer to for sagittal and coronal sequences? One way to discover this is to look at the PDFs that you can create for your sequence. As shown in the image on the right, ascending for sagittal scans refers to right-to-left (R&amp;gt;&amp;gt;L), for coronal sequences ascending is anterior-to-posterior (A&amp;gt;&amp;gt;P) and for transverse (axial) slices the order is the expected foot-to-head (F&amp;gt;&amp;gt;H). This appears to be the <a class="reference external" href="https://mri.radiology.uiowa.edu/fmri_images.html">default for Siemens MRI</a> , though perhaps <a class="reference external" href="https://wiki.humanconnectome.org/download/attachments/40534057/CMRR_MB_Slice_Order.pdf?version=2&amp;amp;modificationDate=1386950067494&amp;amp;api=v2">tweaking the “Image Numbering” on the “Miscellaneous” portion of the sequence system tab</a> could disrupt this (though I am not sure why anyone would want to, and it would cause problems for automated methods of slice timing correction as described here).</p>
<p>While the Siemens convention is unusual, the fact that it is consistent means that it is easy to write a script to automatically slice time correct your data. For example, if you convert your DICOM images to NIfTI format with <a class="reference external" href="https://github.com/rordenlab/dcm2niix">dcm2niix</a> ( <a class="reference external" href="https://www.nitrc.org/projects/mricrogl/">included as an executable and a graphical interface with my MRIcroGL viewer</a> ) you will also get a BIDS format file that reports the slice timing information. You can use the Matlab/SPM script below to correct the slice timing using this BIDS file.</p>
</div>
<div class="section" id="siemens-image-numbering">
<h2>Siemens Image Numbering<a class="headerlink" href="#siemens-image-numbering" title="Permalink to this headline">¶</a></h2>
<p>The Siemens scanner allows you to reverse the image numbering, as described in the white paper below. Specifically, for axial acquisitions you can open the exam explorer and go to the ‘System’ tab’s ‘Miscellaneous’ page and set the Transversal Image Numbering to H&amp;gt;&amp;gt;F (instead of the default F&amp;gt;&amp;gt;H). Doing this will flip the order images are displayed in the mosaics (with the upper left being the most superior rather than most inferior slice). There is some confusion regarding whether this option changes merely the image storage or the image acquisition. To test this, I created the examples linked at the bottom of the page. As described previously, each series started with the participant in canonical position in the scanner, but part way through each series they rotated their head so at the end of the volume the nose pointed toward one of their shoulders. As can be seen in the crucial volumes (for Siemens product, see image IM-0004-0002.dcm, for CMRR see IM-0008-0004.dcm) the Siemens Interleaved as well as Ascending volumes are still acquired in the foot-to-head direction. In other words, while changing this value saves how the images are displayed, it does not change how they are acquired. I would discourage using this setting. However, if you do have images with reversed image numbering I would recommend using dcm2niix version v1.0.20171021 or later: prior versions generate a dire warning (and do not correctly specify the slice timing field of the BIDS file).</p>
<a class="reference internal image-reference" href="../_images/siemens_pdf.png"><img alt="../_images/siemens_pdf.png" class="align-center" src="../_images/siemens_pdf.png" style="width: 416px;" /></a>
</div>
<div class="section" id="setting-the-reference-slice">
<h2>Setting the reference slice<a class="headerlink" href="#setting-the-reference-slice" title="Permalink to this headline">¶</a></h2>
<p>Slice timing correction attempts to make all the slices in a volume appear as if they were acquired at the same moment. This allows us to apply a single statistical estimate for the whole volume. By default, SPM’s slice timing will make all slices appear at the same time as the middle slice of the volume, the notion is that we want to apply the least interpolation to the center slices, which are typically our focus of interest. However, you could also align all slices to the first (or last) slice, just make sure you set your onset times accordingly.</p>
</div>
<div class="section" id="tr-versus-ta">
<h2>TR versus TA<a class="headerlink" href="#tr-versus-ta" title="Permalink to this headline">¶</a></h2>
<p>Typically, we acquire fMRI data continuously with no gaps between volumes. Therefore, the acquisition time (TA) is directly related to the repeat time (TR). Specifically, the TA volume with N slices is TR-(TR/N). In other words, if we have a volume with 4 slices and a TR of 2000ms, the TA is 1500ms (with slices acquired at 0, 500, 1000, 1500ms). However, note that it is possible to set a temporal gap between volumes (we do this for sparse designs). Therefore, you should check this prior to STC.</p>
</div>
<div class="section" id="links">
<h2>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>The <a class="reference external" href="https://practicalfmri.blogspot.com/2012/07/siemens-slice-ordering.html">practiCal page</a> has a nice description of slice timing.</p></li>
<li><p><a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3167249/">Paper</a> demonstrating how slice timing can help.</p></li>
<li><p>The <a class="reference external" href="https://wiki.humanconnectome.org/display/PublicData/HCP+fMRI+slice-timing+acquisition+parameters">HCP webpage</a> includes the details for users of the popular CMRR sequences.</p></li>
<li><p>Siemens includes a <a class="reference external" href="https://www.healthcare.siemens.com/siemens_hwem-hwem_ssxa_websites-context-root/wcm/idc/groups/public/&#64;global/&#64;imaging/&#64;mri/documents/download/mdaz/nzmy/~edisp/mri_60_graessner-01646277.pdf">white paper</a> describing slice order.</p></li>
<li><p><a class="reference external" href="http://ani.aalto.fi/en/ami_centre/facilities/miscellaneous/ami_misc_slice_order.pdf">Here</a> is a nice description of slice order on Siemens.</p></li>
<li><p>There is a nice <a class="reference external" href="https://en.wikibooks.org/w/index.php?title=SPM/Slice_Timing#Slice_Order">wiki page</a> on slice order.</p></li>
</ul>
</div></blockquote>
</div>
</div>


        </div>
      </div>

      <div id="side-menu-container">

        <div id="search" role="search">
        <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
            <input type="text" name="q" placeholder="Search..." />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
</div>

        <div id="side-menu" role="navigation">

          
  
    
  
  
    <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../asl/index.html">Arterial Spin Labeling (ASL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blindside/index.html">Blindside</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bmp_contrast/index.html">Bitmap Contrast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CenterOfCancellation/index.html">Center of Cancellation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../directions/index.html">Directions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../diyFmri/index.html">DIY fMRI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dti/index.html">DTI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elecro/index.html">ELEcro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../EMGRecorder/index.html">EMG Recorder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fieldmaps/index.html">Fieldmaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fmriSimulator/index.html">fMRI Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jpeg-formats/index.html">JPEG Format Variations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mriconcepts/index.html">MRI Contrast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mricro/index.html">MRIcro for macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gl/index.html">MRIcroGL Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gl/extract/index.html">MRIcroGL Object Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gl/gradients/index.html">MRIcroGL Gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gl/shaders/index.html">MRIcroGL Shaders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../open-source-eegecgemg/index.html">DIY Electrophysiology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimizingspmfsl/index.html">Optimizing FSL and SPM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oscilloscope/index.html">Oscilloscope using Teensy or Arduino</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part/index.html">Physiological Artifact Removal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../psyc450/index.html">Sensation and Perception (PSYC450)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../psyc589888/index.html">Image to Inference (PSYC589/888)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pwi/index.html">Perfusion-weighted imaging (PWI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qa/index.html">Quality Assurance (QA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spatial/index.html">Spatial Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spm8-scripts/index.html">spmScripts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Slice Time Correction (STC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stimsync/index.html">StimSync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stimsync-api/index.html">StimSync API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../temporal/index.html">Temporal Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications/index.html">Publications</a></li>
</ul>

  


        </div>

        

      </div>

    </div>

<footer>
    <div id="footer-info">
        <ul id="build-details">
            
                <li class="footer-element">
                    
                        <a href="../_sources/stc/index.rst.txt" rel="nofollow"> source</a>
                    
                </li>
            

            

            
        </ul>
        <div id="credit">
            created with <a href="http://sphinx-doc.org/">Sphinx</a> and <a href="https://github.com/Autophagy/insegel">Insegel</a>

        </div>
    </div>

    <a id="menu-toggle" class="fa fa-bars" aria-hidden="true"></a>

    <script type="text/javascript">
      $("#menu-toggle").click(function() {
        $("#menu-toggle").toggleClass("toggled");
        $("#side-menu-container").slideToggle(300);
      });
    </script>

</footer> 

</div>

</body>
</html>